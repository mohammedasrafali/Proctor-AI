{% extends 'home.html' %}

{% block content %}

<style>
    .contain{
            background: rgb(255, 255, 255);
            width: 700px;
            height: 480px;
            position: relative;
            margin-left: 45%;
            margin-top: 3%;
            /* padding: 10px; */
            border: 20px;
            border-color: beige;
        }

        .contain img{
            position: absolute;
            /* margin-left: 2%;
            margin-top: 2%; */
            margin: 1.5% 0% 0% 2.5%;
            width: 95%;
            height: 95%;
            /* padding: 10px; */
            
        }

        .question_base{
            background: black;
    color: white;
    width: 45%;
    margin-left: 54%;
    padding: 50px;
    top: 20%;
    position: absolute;
        }

    input{
        padding-right: 10px;
    }  
    
    body{
        background-image: url('static/exam.jpg');
        background-size: cover;
        background-repeat: no-repeat;
        /* filter: blur(10px); */
    }

    body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('static/exam.jpg') center/cover no-repeat;
            filter: blur(7px); /* Adjust the blur amount as needed */
            z-index: -1;
        }

        .content {
            z-index: 1;
            color: white; /* Adjust text color for visibility */
        }
</style>
<div class="blur-background"></div>
<div class="content">
{% if code %}
<img id="liveFeed" src="{% url 'App:procotor' %}" alt="Live Feed" >

<div class="question_base">
    <div class="question_1" id="1" style="display: none;">
        <div class="questions">
            <p>{{quest.question1}}</p>
        </div>
        <div class="options mb-5">
            <div class="form-check mb-2">
                <input type="radio" id="py" class="form-check-input" name="language">
                <label for="py" class="form-check-label">{{ quest.quest1_option1 }}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="html" class="form-check-input" name="language">
                <label for="html" class="form-check-label">{{ quest.quest1_option2 }}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="css" class="form-check-input" name="language">
                <label for="css" class="form-check-label">{{ quest.quest1_option3 }}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="js" class="form-check-input" name="language">
                <label for="js" class="form-check-label">{{ quest.quest1_option4 }}</label>
            </div>
        </div>
        
        <div class="sub mt-5 d-flex justify-content-center align-items-center">
            <button onclick="question2()" class="btn btn-primary">Submit</button>
        </div>
    </div>
    <div class="question_1" id="2" style="display: none;">
        <div class="questions">
            <p>{{quest.question2}}</p>
        </div>
        <div class="options mb-5">
            <div class="form-check mb-2">
                <input type="radio" id="py" class="form-check-input" name="language">
                <label for="py" class="form-check-label">{{quest.quest2_option1}}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="html" class="form-check-input" name="language">
                <label for="html" class="form-check-label">{{quest.quest2_option2}}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="css" class="form-check-input" name="language">
                <label for="css" class="form-check-label">{{quest.quest2_option3}}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="js" class="form-check-input" name="language">
                <label for="js" class="form-check-label">{{quest.quest2_option4}}</label>
            </div>
        </div>
        
        <div class="sub mt-5 d-flex justify-content-center align-items-center">
            <button onclick="question3()" class="btn btn-primary">Submit</button>
        </div>
    </div>
    <div class="question_1" id="3" style="display: none;">
        <div class="questions">
            <p>{{quest.question3}}</p>
        </div>
        <div class="options mb-5">
            <div class="form-check mb-2">
                <input type="radio" id="py" class="form-check-input" name="language">
                <label for="py" class="form-check-label">{{quest.quest3_option1}}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="html" class="form-check-input" name="language">
                <label for="html" class="form-check-label">{{quest.quest3_option2}}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="css" class="form-check-input" name="language">
                <label for="css" class="form-check-label">{{quest.quest3_option3}}</label>
            </div>
        
            <div class="form-check mb-2">
                <input type="radio" id="js" class="form-check-input" name="language">
                <label for="js" class="form-check-label">{{quest.quest3_option4}}</label>
            </div>
        </div>
        
        <div class="sub mt-5 d-flex justify-content-center align-items-center">
            <button onclick="submit()" class="btn btn-primary">Submit</button>
        </div>
    </div>
</div>
</div>

<script>

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
var csrftoken = getCookie('csrftoken');
    var question_1 = document.getElementById('1')
    var question_2 = document.getElementById('2')
    var question_3 = document.getElementById('3')

    function question2(){
        question_1.style.display = 'none';
        question_2.style.display = 'block';
    } 
    function question3(){
        question_2.style.display = 'none';
        question_3.style.display = 'block';
    } 
    function submit(){
        window.location.href = 'http://127.0.0.1:8000/exit_exam'
    } 

    function checkImage() {
        var liveFeedImage = document.getElementById('liveFeed');

        // Check if the image has loaded
        if (liveFeedImage.complete) {
            console.log('Image has loaded successfully!');
            question_1.style.display = 'block';
            clearInterval(intervalId);
        } 
    }
    var intervalId = setInterval(checkImage, 1000);

//     let isTabActive = true;

// window.addEventListener('blur', function() {
//   isTabActive = false;
// });

// window.addEventListener('focus', function() {
//   isTabActive = true;
//   checkTabStatus()
// });

document.addEventListener("visibilitychange", function () {
  if (document.hidden) {
    // The tab is not visible (e.g., user switched to a different tab)
    console.log("Tab is now hidden");
    checkTabStatus()
  } else {
    // The tab is visible again
    console.log("Tab is now visible");
  }
});


function checkTabStatus() {
    $.ajax({
        url: 'http://127.0.0.1:8000/api/tab_change',
        type: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json', 
        },
        data: JSON.stringify({ "tab": true }), 
        success: function(data){
        // console.log('New user created:', data.message);
        console.log(data)
        // $('#registerModal').modal('hide'); 
        // location.reload();

    },
        error: function(error) {
            console.error(error);
        }
    });
  }


// You can call the checkTabStatus function at regular intervals to check if the user has switched tabs
// setInterval(checkTabStatus, 1000);


//     function checkExamStatus() {
//     var xhr = new XMLHttpRequest();
//     xhr.open('GET', 'http://127.0.0.1:8000/exam', true);

//     xhr.onload = function () {
//         if (xhr.status >= 200 && xhr.status < 300) {
//             var responseData = JSON.parse(xhr.responseText);
//             // Check if the exam should be blocked
//             if (responseData.block_exam) {
//                 // Redirect to a new URL
//                 window.location.href = 'http://127.0.0.1:8000';
//             } 
//         } 
//     };

//     xhr.onerror = function () {
//         console.error('Network error occurred');
//     };

//     xhr.send();
// }

// // Call the function every 1 second
// setInterval(checkExamStatus, 1000);

</script>

{% else %}

<center>
    <div class="d-felx flex-column align-items-center mt-5">
        <form action="exam" method="post">
            {% csrf_token %}
        <p >Enter Exam Code</p> <input type="number" name="code"><br>
        <button type="submit" class="btn btn-primary mt-5">Submit</button>
        </form>
    </div>
</center>
</div>

{% endif %}





    
{% endblock content %}